temp_df_XY_all <- inner_join(temp_df_XY, tiff_35_39_complete, by = "uniqueID")
names(temp_df_XY_all) <- c("X", "Y", "sero", "UC", "LC", "uniqueID", "x", "y", "pop")
temp_df_XY_all <- temp_df_XY_all%>%
mutate(burden = (1-sero) * pop)%>%
mutate(burden_UC = (1-UC) * pop)%>%
mutate(burden_LC = (1-LC) * pop)
assign(paste0(antigens[i], "_", age_ranges[j*2-1], "_", age_ranges[j*2],"_burden"), temp_df_XY_all)
} else{
temp_df_XY_all <- inner_join(temp_df_XY, tiff_40_44_complete, by = "uniqueID")
names(temp_df_XY_all) <- c("X", "Y", "sero", "UC", "LC", "uniqueID", "x", "y", "pop")
temp_df_XY_all <- temp_df_XY_all%>%
mutate(burden = (1-sero) * pop)%>%
mutate(burden_UC = (1-UC) * pop)%>%
mutate(burden_LC = (1-LC) * pop)
assign(paste0(antigens[i], "_", age_ranges[j*2-1], "_", age_ranges[j*2],"_burden"), temp_df_XY_all)
}
}
}
}
}
}
rlang::last_error()
tiff_15_19_complete <- tiff_15_19_complete%>%
mutate(uniqueID = paste(x, y, by = " "))
tiff_20_24_complete <- tiff_20_24_complete%>%
mutate(uniqueID = paste(x, y, by = " "))
tiff_25_29_complete <- tiff_25_29_complete%>%
mutate(uniqueID = paste(x, y, by = " "))
tiff_30_34_complete <- tiff_30_34_complete%>%
mutate(uniqueID = paste(x, y, by = " "))
tiff_35_39_complete <- tiff_35_39_complete%>%
mutate(uniqueID = paste(x, y, by = " "))
tiff_40_44_complete <- tiff_40_44_complete%>%
mutate(uniqueID = paste(x, y, by = " "))
tiff_0_4_complete <- tiff_0_4_complete%>%
mutate(uniqueID = paste(x, y, by = " "))
tiff_5_9_complete <- tiff_5_9_complete%>%
mutate(uniqueID = paste(x, y, by = " "))
tiff_10_14_complete <- tiff_10_14_complete%>%
mutate(uniqueID = paste(x, y, by = " "))
tiff_0_14_complete <- tiff_0_4_complete%>%
mutate(value_total = value +tiff_5_9_complete$value +tiff_10_14_complete$value)%>%
dplyr::select(x,y,value_total)
save(tiff_0_4_complete, tiff_5_9_complete, tiff_10_14_complete, tiff_15_19_complete, tiff_20_24_complete, tiff_25_29_complete,
tiff_30_34_complete, tiff_35_39_complete, tiff_40_44_complete, file = "Intermediate/WorldPop.RData")
load("Intermediate/WorldPop.RData")
for(i in 1:length(antigens)){
for(j in 1:6){
length_range <- rep(age_ranges[j*2-1]: (age_ranges[j*2]-1))
overall_temp_df <- c()
overall_temp_UC_df <- c()
overall_temp_LC_df <- c()
for(k in 1:length(length_range)){
temp_df <- get(paste0(antigens[i],"_fit_",length_range[k]))
UC_df <- get(paste0(antigens[i],"_UC_", length_range[k]))
LC_df <- get(paste0(antigens[i],"_LC_", length_range[k]))
overall_temp_df <- cbind(overall_temp_df, temp_df)
overall_temp_UC_df <- cbind(overall_temp_UC_df, UC_df)
overall_temp_LC_df <- cbind(overall_temp_LC_df, LC_df)
if(k == 5){
if (i == 1){
#Tetanus
temp_rowmeans <- rowMeans(overall_temp_df)
UC_rowmeans <- rowMeans(overall_temp_UC_df)
LC_rowmeans <- rowMeans(overall_temp_LC_df)
temp_df_XY <- cbind(XY, temp_rowmeans, UC_rowmeans, LC_rowmeans)
temp_df_XY <- temp_df_XY%>%
mutate(uniqueID = paste(X, Y, by = " "))
if(j == 1){
temp_df_XY_all <- inner_join(temp_df_XY, risky_under25, by = "uniqueID")%>%
inner_join(df_mat_3_total, by = "uniqueID")%>%
inner_join(tiff_15_19_complete, by = "uniqueID")
names(temp_df_XY_all) <- c("X", "Y", "sero", "UC", "LC", "uniqueID", "risk", "asfr", "x","y",  "pop")
temp_df_XY_all <- temp_df_XY_all%>%
mutate(total_risk = (1-sero) * risk * asfr)%>%
mutate(risk_UC = (1-UC)*risk *asfr)%>%
mutate(risk_LC = (1-LC)*risk*asfr)%>%
mutate(burden = (1-sero) * risk * asfr * pop)%>%
mutate(burden_UC = (1-UC) * risk * asfr * pop)%>%
mutate(burden_LC = (1-LC) * risk * asfr * pop)
assign(paste0(antigens[i], "_", age_ranges[j*2-1], "_", age_ranges[j*2],"_burden"), temp_df_XY_all)
}else if(j == 2){
temp_df_XY_all <- inner_join(temp_df_XY, risky_under25, by = "uniqueID")%>%
inner_join(df_mat_4_total, by = "uniqueID")%>%
inner_join(tiff_20_24_complete, by = "uniqueID")
names(temp_df_XY_all) <- c("X", "Y", "sero", "UC", "LC", "uniqueID", "risk", "asfr", "x","y",  "pop")
temp_df_XY_all <- temp_df_XY_all%>%
mutate(total_risk = (1-sero) * risk * asfr)%>%
mutate(risk_UC = (1-UC)*risk *asfr)%>%
mutate(risk_LC = (1-LC)*risk*asfr)%>%
mutate(burden = (1-sero) * risk * asfr * pop)%>%
mutate(burden_UC = (1-UC) * risk * asfr * pop)%>%
mutate(burden_LC = (1-LC) * risk * asfr * pop)
assign(paste0(antigens[i], "_", age_ranges[j*2-1], "_", age_ranges[j*2],"_burden"), temp_df_XY_all)
} else if(j == 3){
temp_df_XY_all <- inner_join(temp_df_XY, risky_over25, by = "uniqueID")%>%
inner_join(df_mat_5_total, by = "uniqueID")%>%
inner_join(tiff_25_29_complete, by = "uniqueID")
names(temp_df_XY_all) <- c("X", "Y", "sero", "UC", "LC", "uniqueID", "risk", "asfr","x","y", "pop")
temp_df_XY_all <- temp_df_XY_all%>%
mutate(total_risk = (1-sero) * risk * asfr)%>%
mutate(risk_UC = (1-UC)*risk *asfr)%>%
mutate(risk_LC = (1-LC)*risk*asfr)%>%
mutate(burden = (1-sero) * risk * asfr * pop)%>%
mutate(burden_UC = (1-UC) * risk * asfr * pop)%>%
mutate(burden_LC = (1-LC) * risk * asfr * pop)
assign(paste0(antigens[i], "_", age_ranges[j*2-1], "_", age_ranges[j*2],"_burden"), temp_df_XY_all)
} else if (j == 4){
temp_df_XY_all <- inner_join(temp_df_XY, risky_over25, by = "uniqueID")%>%
inner_join(df_mat_6_total, by = "uniqueID")%>%
inner_join(tiff_30_34_complete, by = "uniqueID")
names(temp_df_XY_all) <- c("X", "Y", "sero", "UC", "LC", "uniqueID", "risk", "asfr","x","y", "pop")
temp_df_XY_all <- temp_df_XY_all%>%
mutate(total_risk = (1-sero) * risk * asfr)%>%
mutate(risk_UC = (1-UC)*risk *asfr)%>%
mutate(risk_LC = (1-LC)*risk*asfr)%>%
mutate(burden = (1-sero) * risk * asfr * pop)%>%
mutate(burden_UC = (1-UC) * risk * asfr * pop)%>%
mutate(burden_LC = (1-LC) * risk * asfr * pop)
assign(paste0(antigens[i], "_", age_ranges[j*2-1], "_", age_ranges[j*2],"_burden"), temp_df_XY_all)
} else if( j == 5){
temp_df_XY_all <- inner_join(temp_df_XY, risky_over25, by = "uniqueID")%>%
inner_join(df_mat_7_total, by = "uniqueID")%>%
inner_join(tiff_35_39_complete, by = "uniqueID")
names(temp_df_XY_all) <- c("X", "Y", "sero", "UC", "LC", "uniqueID", "risk", "asfr","x","y", "pop")
temp_df_XY_all <- temp_df_XY_all%>%
mutate(total_risk = (1-sero) * risk * asfr)%>%
mutate(risk_UC = (1-UC)*risk *asfr)%>%
mutate(risk_LC = (1-LC)*risk*asfr)%>%
mutate(burden = (1-sero) * risk * asfr * pop)%>%
mutate(burden_UC = (1-UC) * risk * asfr * pop)%>%
mutate(burden_LC = (1-LC) * risk * asfr * pop)
assign(paste0(antigens[i], "_", age_ranges[j*2-1], "_", age_ranges[j*2],"_burden"), temp_df_XY_all)
} else{
temp_df_XY_all <- inner_join(temp_df_XY, risky_over25, by = "uniqueID")%>%
inner_join(df_mat_8_total, by = "uniqueID")%>%
inner_join(tiff_40_44_complete, by = "uniqueID")
names(temp_df_XY_all) <- c("X", "Y", "sero", "UC", "LC", "uniqueID", "risk", "asfr", "x","y", "pop")
temp_df_XY_all <- temp_df_XY_all%>%
mutate(total_risk = (1-sero) * risk * asfr)%>%
mutate(risk_UC = (1-UC)*risk *asfr)%>%
mutate(risk_LC = (1-LC)*risk*asfr)%>%
mutate(burden = (1-sero) * risk * asfr * pop)%>%
mutate(burden_UC = (1-UC) * risk * asfr * pop)%>%
mutate(burden_LC = (1-LC) * risk * asfr * pop)
assign(paste0(antigens[i], "_", age_ranges[j*2-1], "_", age_ranges[j*2],"_burden"), temp_df_XY_all)
}
} else if(i == 2){
#Rubella
temp_rowmeans <- rowMeans(overall_temp_df)
UC_rowmeans <- rowMeans(overall_temp_UC_df)
LC_rowmeans <- rowMeans(overall_temp_LC_df)
temp_df_XY <- cbind(XY, temp_rowmeans, UC_rowmeans, LC_rowmeans)
temp_df_XY <- temp_df_XY%>%
mutate(uniqueID = paste(X, Y, by = " "))
if(j == 1){
temp_df_XY_all <- inner_join(temp_df_XY, df_mat_3_total, by = "uniqueID")%>%
inner_join(tiff_15_19_complete, by = "uniqueID")
names(temp_df_XY_all) <- c("X", "Y", "sero", "UC", "LC", "uniqueID", "asfr", "x", "y", "pop")
temp_df_XY_all <- temp_df_XY_all%>%
mutate(total_risk = (1-sero) * asfr)%>%
mutate(risk_UC = (1-UC)*asfr)%>%
mutate(risk_LC = (1-LC)*asfr)%>%
mutate(burden = (1-sero)  * asfr * pop)%>%
mutate(burden_UC = (1-UC)  * asfr * pop)%>%
mutate(burden_LC = (1-LC) * asfr * pop)
assign(paste0(antigens[i], "_", age_ranges[j*2-1], "_", age_ranges[j*2],"_burden"), temp_df_XY_all)
}else if(j == 2){
temp_df_XY_all <- inner_join(temp_df_XY, df_mat_4_total, by = "uniqueID")%>%
inner_join(tiff_20_24_complete, by = "uniqueID")
names(temp_df_XY_all) <- c("X", "Y", "sero", "UC", "LC", "uniqueID", "asfr", "x", "y", "pop")
temp_df_XY_all <- temp_df_XY_all%>%
mutate(total_risk = (1-sero) * asfr)%>%
mutate(risk_UC = (1-UC)*asfr)%>%
mutate(risk_LC = (1-LC)*asfr)%>%
mutate(burden = (1-sero)  * asfr * pop)%>%
mutate(burden_UC = (1-UC)  * asfr * pop)%>%
mutate(burden_LC = (1-LC) * asfr * pop)
assign(paste0(antigens[i], "_", age_ranges[j*2-1], "_", age_ranges[j*2],"_burden"), temp_df_XY_all)
} else if(j == 3){
temp_df_XY_all <- inner_join(temp_df_XY, df_mat_5_total, by = "uniqueID")%>%
inner_join(tiff_25_29_complete, by = "uniqueID")
names(temp_df_XY_all) <- c("X", "Y", "sero", "UC", "LC", "uniqueID", "asfr", "x", "y", "pop")
temp_df_XY_all <- temp_df_XY_all%>%
mutate(total_risk = (1-sero) * asfr)%>%
mutate(risk_UC = (1-UC)*asfr)%>%
mutate(risk_LC = (1-LC)*asfr)%>%
mutate(burden = (1-sero)  * asfr * pop)%>%
mutate(burden_UC = (1-UC)  * asfr * pop)%>%
mutate(burden_LC = (1-LC) * asfr * pop)
assign(paste0(antigens[i], "_", age_ranges[j*2-1], "_", age_ranges[j*2],"_burden"), temp_df_XY_all)
} else if (j == 4){
temp_df_XY_all <- inner_join(temp_df_XY, df_mat_6_total, by = "uniqueID")%>%
inner_join(tiff_30_34_complete, by = "uniqueID")
names(temp_df_XY_all) <- c("X", "Y", "sero", "UC", "LC", "uniqueID", "asfr", "x", "y", "pop")
temp_df_XY_all <- temp_df_XY_all%>%
mutate(total_risk = (1-sero) * asfr)%>%
mutate(risk_UC = (1-UC)*asfr)%>%
mutate(risk_LC = (1-LC)*asfr)%>%
mutate(burden = (1-sero)  * asfr * pop)%>%
mutate(burden_UC = (1-UC)  * asfr * pop)%>%
mutate(burden_LC = (1-LC) * asfr * pop)
assign(paste0(antigens[i], "_", age_ranges[j*2-1], "_", age_ranges[j*2],"_burden"), temp_df_XY_all)
} else if( j == 5){
temp_df_XY_all <- inner_join(temp_df_XY, df_mat_7_total, by = "uniqueID")%>%
inner_join(tiff_35_39_complete, by = "uniqueID")
names(temp_df_XY_all) <- c("X", "Y", "sero", "UC", "LC", "uniqueID", "asfr", "x", "y", "pop")
temp_df_XY_all <- temp_df_XY_all%>%
mutate(total_risk = (1-sero) * asfr)%>%
mutate(risk_UC = (1-UC)*asfr)%>%
mutate(risk_LC = (1-LC)*asfr)%>%
mutate(burden = (1-sero)  * asfr * pop)%>%
mutate(burden_UC = (1-UC)  * asfr * pop)%>%
mutate(burden_LC = (1-LC) * asfr * pop)
assign(paste0(antigens[i], "_", age_ranges[j*2-1], "_", age_ranges[j*2],"_burden"), temp_df_XY_all)
} else{
temp_df_XY_all <- inner_join(temp_df_XY, df_mat_8_total, by = "uniqueID")%>%
inner_join(tiff_40_44_complete, by = "uniqueID")
names(temp_df_XY_all) <- c("X", "Y", "sero", "UC", "LC", "uniqueID", "asfr", "x", "y", "pop")
temp_df_XY_all <- temp_df_XY_all%>%
mutate(total_risk = (1-sero) * asfr)%>%
mutate(risk_UC = (1-UC)*asfr)%>%
mutate(risk_LC = (1-LC)*asfr)%>%
mutate(burden = (1-sero)  * asfr * pop)%>%
mutate(burden_UC = (1-UC)  * asfr * pop)%>%
mutate(burden_LC = (1-LC) * asfr * pop)
assign(paste0(antigens[i], "_", age_ranges[j*2-1], "_", age_ranges[j*2],"_burden"), temp_df_XY_all)
}
} else{
#Measles and Diphtheria
temp_rowmeans <- rowMeans(overall_temp_df)
UC_rowmeans <- rowMeans(overall_temp_UC_df)
LC_rowmeans <- rowMeans(overall_temp_LC_df)
temp_df_XY <- cbind(XY, temp_rowmeans, UC_rowmeans, LC_rowmeans)
temp_df_XY <- temp_df_XY%>%
mutate(uniqueID = paste(X, Y, by = " "))
if(j == 1){
temp_df_XY_all <- inner_join(temp_df_XY, tiff_15_19_complete, by = "uniqueID")
names(temp_df_XY_all) <- c("X", "Y", "sero", "UC", "LC", "uniqueID", "x", "y", "pop")
temp_df_XY_all <- temp_df_XY_all%>%
mutate(burden = (1-sero) * pop)%>%
mutate(burden_UC = (1-UC) * pop)%>%
mutate(burden_LC = (1-LC) * pop)
assign(paste0(antigens[i], "_", age_ranges[j*2-1], "_", age_ranges[j*2],"_burden"), temp_df_XY_all)
}else if(j == 2){
temp_df_XY_all <- inner_join(temp_df_XY, tiff_20_24_complete, by = "uniqueID")
names(temp_df_XY_all) <- c("X", "Y", "sero", "UC", "LC", "uniqueID", "x", "y", "pop")
temp_df_XY_all <- temp_df_XY_all%>%
mutate(burden = (1-sero) * pop)%>%
mutate(burden_UC = (1-UC) * pop)%>%
mutate(burden_LC = (1-LC) * pop)
assign(paste0(antigens[i], "_", age_ranges[j*2-1], "_", age_ranges[j*2],"_burden"), temp_df_XY_all)
} else if(j == 3){
temp_df_XY_all <- inner_join(temp_df_XY, tiff_25_29_complete, by = "uniqueID")
names(temp_df_XY_all) <- c("X", "Y", "sero", "UC", "LC", "uniqueID", "x", "y", "pop")
temp_df_XY_all <- temp_df_XY_all%>%
mutate(burden = (1-sero) * pop)%>%
mutate(burden_UC = (1-UC) * pop)%>%
mutate(burden_LC = (1-LC) * pop)
assign(paste0(antigens[i], "_", age_ranges[j*2-1], "_", age_ranges[j*2],"_burden"), temp_df_XY_all)
} else if (j == 4){
temp_df_XY_all <- inner_join(temp_df_XY, tiff_30_34_complete, by = "uniqueID")
names(temp_df_XY_all) <- c("X", "Y", "sero", "UC", "LC", "uniqueID", "x", "y", "pop")
temp_df_XY_all <- temp_df_XY_all%>%
mutate(burden = (1-sero) * pop)%>%
mutate(burden_UC = (1-UC) * pop)%>%
mutate(burden_LC = (1-LC) * pop)
assign(paste0(antigens[i], "_", age_ranges[j*2-1], "_", age_ranges[j*2],"_burden"), temp_df_XY_all)
} else if( j == 5){
temp_df_XY_all <- inner_join(temp_df_XY, tiff_35_39_complete, by = "uniqueID")
names(temp_df_XY_all) <- c("X", "Y", "sero", "UC", "LC", "uniqueID", "x", "y", "pop")
temp_df_XY_all <- temp_df_XY_all%>%
mutate(burden = (1-sero) * pop)%>%
mutate(burden_UC = (1-UC) * pop)%>%
mutate(burden_LC = (1-LC) * pop)
assign(paste0(antigens[i], "_", age_ranges[j*2-1], "_", age_ranges[j*2],"_burden"), temp_df_XY_all)
} else{
temp_df_XY_all <- inner_join(temp_df_XY, tiff_40_44_complete, by = "uniqueID")
names(temp_df_XY_all) <- c("X", "Y", "sero", "UC", "LC", "uniqueID", "x", "y", "pop")
temp_df_XY_all <- temp_df_XY_all%>%
mutate(burden = (1-sero) * pop)%>%
mutate(burden_UC = (1-UC) * pop)%>%
mutate(burden_LC = (1-LC) * pop)
assign(paste0(antigens[i], "_", age_ranges[j*2-1], "_", age_ranges[j*2],"_burden"), temp_df_XY_all)
}
}
}
}
}
}
age_groups <- c("15_20", "20_25", "25_30", "30_35", "35_40", "40_45")
#Combine age group results to generate one df for each antigen
for(i in 1:length(antigens)){
final_data_df <- as.data.frame(matrix(ncol = 16))
names(final_data_df) <- c("risky_birth", "asfr", "sero", "sero_UC", "sero_LC", "risk", "risk_UC", "risk_LC", "pop_risk", "pop_risk_UC", "pop_risk_LC", "population", "age_group", "antigen", "X", "Y")
if(i == 1){
total_antigens <- as.data.frame(matrix(ncol = 16))
names(total_antigens) <- c("risky_birth", "asfr", "sero", "sero_UC", "sero_LC", "risk", "risk_UC", "risk_LC", "pop_risk", "pop_risk_UC", "pop_risk_LC", "population", "age_group", "antigen", "X", "Y")
#Tetanus
for(j in 1:length(age_groups)){
temp_sero <-  get(paste0(antigens[i],"_",age_groups[j],"_burden"))$sero
temp_sero_UC <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$UC
temp_sero_LC <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$LC
temp_risk <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$risk
temp_asfr <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$asfr
temp_total_risk <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$total_risk
temp_risk_UC <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$risk_UC
temp_risk_LC <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$risk_LC
temp_total <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$burden
temp_burden_UC <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$burden_UC
temp_burden_LC <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$burden_LC
temp_pop <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$pop
total_antigens_temp <- as.data.frame(cbind(temp_risk, temp_asfr, temp_sero, temp_sero_UC, temp_sero_LC,temp_total_risk, temp_risk_UC,
temp_risk_LC,temp_total, temp_burden_UC, temp_burden_LC, temp_pop))
total_antigens_temp$age_group <- age_groups[j]
total_antigens_temp$antigen <- antigens[i]
total_antigens_temp$X <- tet_15_20_burden$X
total_antigens_temp$Y <- tet_15_20_burden$Y
names(total_antigens_temp) <- c("risky_birth", "asfr", "sero", "sero_UC", "sero_LC", "risk", "risk_UC", "risk_LC", "pop_risk", "pop_risk_UC", "pop_risk_LC", "population", "age_group", "antigen", "X", "Y")
total_antigens <- rbind(total_antigens, total_antigens_temp)
}
total_antigens <- total_antigens%>%
filter(!is.na(X))
assign(paste0(antigens[i], "_total_df"), total_antigens)
}
else if(i == 2){
#Rubella
total_antigens <- as.data.frame(matrix(ncol = 16))
names(total_antigens) <- c("risky_birth", "asfr", "sero", "sero_UC", "sero_LC", "risk", "risk_UC", "risk_LC", "pop_risk", "pop_risk_UC", "pop_risk_LC", "population", "age_group", "antigen", "X", "Y")
for(j in 1:length(age_groups)){
temp_sero <-  get(paste0(antigens[i],"_",age_groups[j],"_burden"))$sero
temp_sero_UC <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$UC
temp_sero_LC <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$LC
temp_total_risk <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$total_risk
temp_risk_UC <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$risk_UC
temp_risk_LC <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$risk_LC
temp_total <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$burden
temp_burden_UC <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$burden_UC
temp_burden_LC <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$burden_LC
temp_pop <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$pop
temp_risk <- NA
temp_asfr <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$asfr
total_antigens_temp <- as.data.frame(cbind(temp_risk, temp_asfr, temp_sero, temp_sero_UC, temp_sero_LC,temp_total_risk, temp_risk_UC,
temp_risk_LC,temp_total, temp_burden_UC, temp_burden_LC, temp_pop))
total_antigens_temp$age_group <- age_groups[j]
total_antigens_temp$antigen <- antigens[i]
total_antigens_temp$X <- tet_15_20_burden$X
total_antigens_temp$Y <- tet_15_20_burden$Y
names(total_antigens_temp) <- c("risky_birth", "asfr", "sero", "sero_UC", "sero_LC", "risk", "risk_UC", "risk_LC", "pop_risk", "pop_risk_UC", "pop_risk_LC", "population", "age_group", "antigen", "X", "Y")
total_antigens <- rbind(total_antigens, total_antigens_temp)
}
total_antigens <- total_antigens%>%
filter(!is.na(X))
assign(paste0(antigens[i], "_total_df"), total_antigens)
} else {
total_antigens <- as.data.frame(matrix(ncol = 16))
names(total_antigens) <- c("risky_birth", "asfr", "sero", "sero_UC", "sero_LC", "risk", "risk_UC", "risk_LC", "pop_risk", "pop_risk_UC", "pop_risk_LC", "population", "age_group", "antigen", "X", "Y")
for(j in 1:length(age_groups)){
temp_sero <-  get(paste0(antigens[i],"_",age_groups[j],"_burden"))$sero
temp_sero_UC <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$UC
temp_sero_LC <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$LC
temp_total <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$burden
temp_burden_UC <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$burden_UC
temp_burden_LC <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$burden_LC
temp_pop <- get(paste0(antigens[i],"_",age_groups[j],"_burden"))$pop
temp_total_risk <- NA
temp_risk_UC <- NA
temp_risk_LC <- NA
temp_risk <- NA
temp_asfr <- NA
temp_age_group <- age_groups[j]
total_antigens_temp <- as.data.frame(cbind(temp_risk, temp_asfr, temp_sero, temp_sero_UC, temp_sero_LC,temp_total_risk, temp_risk_UC,
temp_risk_LC,temp_total, temp_burden_UC, temp_burden_LC, temp_pop))
total_antigens_temp$age_group <- age_groups[j]
total_antigens_temp$antigen <- antigens[i]
total_antigens_temp$X <- tet_15_20_burden$X
total_antigens_temp$Y <- tet_15_20_burden$Y
names(total_antigens_temp) <- c("risky_birth", "asfr", "sero", "sero_UC", "sero_LC", "risk", "risk_UC", "risk_LC", "pop_risk", "pop_risk_UC", "pop_risk_LC", "population", "age_group", "antigen", "X", "Y")
total_antigens <- rbind(total_antigens, total_antigens_temp)
}
total_antigens <- total_antigens%>%
filter(!is.na(X))
assign(paste0(antigens[i], "_total_df"), total_antigens)
}
}
for(i in 1:length(antigens)){
temp_sum <- get(paste0(antigens[i], "_total_df"))
temp_sum_sf <- st_as_sf(temp_sum, coords = c("X", "Y"))
st_crs(temp_sum_sf) <- "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"
temp_sum_adm1 <- st_intersection(temp_sum_sf, nigeria_polygon_ad1)
temp_sum_adm1_summ <- temp_sum_adm1%>%
group_by(NAME_1, age_group, antigen)%>%
summarise(weighted.sero = weighted.mean(sero, population, na.rm = TRUE),
weighted.sero.UC = weighted.mean(sero_UC, population, na.rm = TRUE),
weighted.sero.LC = weighted.mean(sero_LC, population, na.rm = TRUE),
weighted.risk = weighted.mean(risk, population, na.rm = TRUE),
weighted.risk.UC = weighted.mean(risk_UC, population, na.rm = TRUE),
weighted.risk.LC = weighted.mean(risk_LC, population, na.rm=TRUE),
pop_risk_adm1 = sum(pop_risk),
pop_risk_UC_adm1 = sum(pop_risk_UC),
pop_risk_LC_adm1 = sum(pop_risk_LC),
total_pop = sum(population))%>%
as.data.frame()%>%
select(-geometry)
assign(paste0(antigens[i], "_adm_1"), temp_sum_adm1_summ)
}
for(i in 1:length(antigens)){
temp_sum <- get(paste0(antigens[i], "_total_df"))
temp_sum_sf <- st_as_sf(temp_sum, coords = c("X", "Y"))
st_crs(temp_sum_sf) <- "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"
temp_sum_adm1 <- st_intersection(temp_sum_sf, nigeria_polygon_ad1)
temp_sum_adm1_summ <- temp_sum_adm1%>%
group_by(NAME_1, age_group, antigen)%>%
summarise(weighted.sero = weighted.mean(sero, population, na.rm = TRUE),
weighted.sero.UC = weighted.mean(sero_UC, population, na.rm = TRUE),
weighted.sero.LC = weighted.mean(sero_LC, population, na.rm = TRUE),
weighted.risk = weighted.mean(risk, population, na.rm = TRUE),
weighted.risk.UC = weighted.mean(risk_UC, population, na.rm = TRUE),
weighted.risk.LC = weighted.mean(risk_LC, population, na.rm=TRUE),
pop_risk_adm1 = sum(pop_risk),
pop_risk_UC_adm1 = sum(pop_risk_UC),
pop_risk_LC_adm1 = sum(pop_risk_LC),
total_pop = sum(population))%>%
as.data.frame()%>%
dplyr::select(-geometry)
assign(paste0(antigens[i], "_adm_1"), temp_sum_adm1_summ)
}
for(i in 1:length(antigens)){
temp_antigens <- as.data.frame(matrix(ncol = 13))
colnames(temp_antigens) <- c("NAME_2", "age_group", "antigen", "weighted.sero", "weighted.sero.UC", "weighted.sero.LC", "weighted.risk",
"weighted.risk.UC", "weighted.risk.LC", "pop_risk_adm2", "pop_risk_UC_adm2", "pop_risk_LC_adm2", "total_pop")
for(j in 1:length(age_groups)){
temp_sum <- get(paste0(antigens[i], "_total_df"))
temp_sum_age <- temp_sum%>%
filter(age_group == age_groups[j])
temp_sum_age_sf <- st_as_sf(temp_sum_age, coords = c("X", "Y"))
st_crs(temp_sum_age_sf) <- "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"
temp_sum_age_adm2 <- st_intersection(temp_sum_age_sf, nigeria_adm2)
temp_sum_age_adm2_sum <- temp_sum_age_adm2%>%
group_by(NAME_2, age_group, antigen)%>%
summarise(weighted.sero = weighted.mean(sero, population, na.rm = TRUE),
weighted.sero.UC = weighted.mean(sero_UC, population, na.rm = TRUE),
weighted.sero.LC = weighted.mean(sero_LC, population, na.rm = TRUE),
weighted.risk = weighted.mean(risk, population, na.rm = TRUE),
weighted.risk.UC = weighted.mean(risk_UC, population, na.rm = TRUE),
weighted.risk.LC = weighted.mean(risk_LC, population, na.rm=TRUE),
pop_risk_adm2 = sum(pop_risk),
pop_risk_UC_adm2 = sum(pop_risk_UC),
pop_risk_LC_adm2 = sum(pop_risk_LC),
total_pop = sum(population))%>%
as.data.frame()%>%
dplyr::select(-geometry)
temp_antigens <- rbind(temp_antigens, temp_sum_age_adm2_sum)
}
assign(paste0(antigens[i], "_adm_2"), temp_antigens)
}
final_adm1 <- as.data.frame(matrix(ncol = 13))
colnames(final_adm1) <- c("NAME_1", "age_group", "antigen", "weighted.sero", "weighted.sero.UC", "weighted.sero.LC", "weighted.risk",
"weighted.risk.UC", "weighted.risk.LC", "pop_risk_adm1", "pop_risk_UC_adm1", "pop_risk_LC_adm1", "total_pop")
final_adm2 <- as.data.frame(matrix(ncol = 13))
colnames(final_adm2) <- c("NAME_2", "age_group", "antigen", "weighted.sero", "weighted.sero.UC", "weighted.sero.LC", "weighted.risk",
"weighted.risk.UC", "weighted.risk.LC", "pop_risk_adm2", "pop_risk_UC_adm2", "pop_risk_LC_adm2", "total_pop")
for (i in 1:length(antigens)){
temp_adm1_anti <- get(paste0(antigens[i], "_adm_1"))
temp_adm2_anti <- get(paste0(antigens[i], "_adm_2"))
final_adm1 <- rbind(final_adm1, temp_adm1_anti)%>%
filter(!is.na(NAME_1))
final_adm2 <- rbind(final_adm2, temp_adm2_anti)%>%
filter(!is.na(NAME_2))
}
View(final_adm1)
View(nigeria_polygon_ad1)
adm1_code <- nigeria_polygon_ad1%>%
as.data.frame()%>%
dplyr::select(GID_1, NAME_1)
View(adm1_code)
adm2_code <- nigeria_adm2%>%
as.data.frame()%>%
dplyr::select(GID_2, NAME_2)
final_adm1 <- left_join(adm1_code, final_adm1, by = "NAME_1")
View(final_adm1)
final_adm2 <- left_join(adm2_code, final_adm2, by = "NAME_2")
write.csv(final_adm1, "Output/PopRisk_State.csv")
write.csv(final_adm2, "Output/PopRisk_LGA.csv")
colnames(final_adm1)
adm1_colnames <- colnames(final_adm1)
adm1_colnames <- adm1_colnames[5:14]
adm1_colnames
final_adm1_wide <- tidyr::pivot_wider(final_adm1, id_cols = NAME_1, names_from = c(age_group, antigen), names_sep = ".", values_from = adm1_colnames)
final_adm1_wide <- tidyr::pivot_wider(final_adm1, id_cols = NAME_1, names_from = c(age_group, antigen), names_sep = ".", values_from = all_of(adm1_colnames))
View(final_adm1_wide)
final_adm1_wide <- tidyr::pivot_wider(final_adm1, id_cols = NAME_1, names_from = c(age_group, antigen), names_sep = "_", values_from = all_of(adm1_colnames))
final_adm1_wide <- left_join(adm1_code, final_adm1_wide, by = "NAME_1")
colnames(final_adm2)
adm2_colnames <- colnames(final_adm2)
adm2_colnames <- adm2_colnames[5:14]
final_adm2_wide <- tidyr::pivot_wider(final_adm2, id_cols = NAME_2, names_from = c(age_group, antigen), names_sep = "_", values_from = all_of(adm2_colnames))
adm2_colnames <- colnames(final_adm2)
adm2_colnames <- adm2_colnames[5:14]
final_adm2_wide <- tidyr::pivot_wider(final_adm2, id_cols = NAME_2, names_from = c(age_group, antigen), names_sep = "_", values_from = all_of(adm2_colnames))
View(final_adm2_wide)
View(final_adm2)
final_adm2_wide <- left_join(adm2_code, final_adm2_wide, by = "NAME_2")
write.csv(final_adm1_wide, "Output/PopRisk_State_Wide.csv")
write.csv(final_adm2_wide, "Output/PopRisk_LGA.csv")
View(final_adm2_wide)
final_adm2_wide <- tidyr::pivot_wider(final_adm2, id_cols = NAME_2, names_from = c(age_group, antigen), names_sep = "_", values_from = all_of(adm2_colnames), values_fn = mean())
final_adm2_wide <- tidyr::pivot_wider(final_adm2, id_cols = NAME_2, names_from = c(age_group, antigen), names_sep = "_", values_from = all_of(adm2_colnames), values_fn = ~mean(.x, na.rm = TRUE))
final_adm2_wide <- tidyr::pivot_wider(final_adm2, id_cols = NAME_2, names_from = c(age_group, antigen), names_sep = "_", values_from = all_of(adm2_colnames), values_fn = mean(.x, na.rm = TRUE))
final_adm2_wide <- tidyr::pivot_wider(final_adm2, id_cols = NAME_2, names_from = c(age_group, antigen), names_sep = "_", values_from = all_of(adm2_colnames), values_fn = ~mean(.x, na.rm = TRUE))
rlang::last_error()
final_adm2_wide <- tidyr::pivot_wider(final_adm2, id_cols = NAME_2, names_from = c(age_group, antigen), names_sep = "_", values_from = all_of(adm2_colnames), values_fn = length)
